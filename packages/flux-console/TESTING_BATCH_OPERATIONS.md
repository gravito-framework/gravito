# 批次處理功能測試指南

## 🎯 測試目標

驗證以下批次處理功能：
1. ✅ 多選核取方塊
2. ✅ 批次刪除選中的工作
3. ✅ 批次重試選中的工作
4. ✅ 刪除所有匹配的工作
5. ✅ 重試所有匹配的工作
6. ✅ 鍵盤快捷鍵
7. ✅ 確認對話框
8. ✅ 載入狀態

---

## 🚀 快速開始

### 1. 啟動服務

```bash
# 終端機 1: 啟動 Flux Console 後端
cd packages/flux-console
bun run dev:server

# 終端機 2: 啟動 Flux Console 前端
cd packages/flux-console
bun run dev:client
```

### 2. 創建測試資料

```bash
# 終端機 3: 創建測試工作
cd packages/flux-console
bun scripts/test-batch-operations.ts create
```

這會創建：
- **test-batch**: 100 個正常工作
- **test-batch-fail**: 50 個會失敗的工作
- **test-batch-delayed**: 30 個延遲工作

### 3. 模擬失敗

```bash
bun scripts/test-batch-operations.ts fail
```

這會在 `test-batch-fail` 佇列中創建 25 個失敗的工作。

---

## 📋 測試案例

### 測試案例 1: 多選與批次刪除

**步驟：**
1. 打開瀏覽器訪問 `http://localhost:3000`
2. 點擊 "Processing Queues" 頁面
3. 找到 `test-batch` 佇列，點擊 "Inspect"
4. 勾選 5-10 個工作的核取方塊
5. 觀察右上角顯示 "X items selected"
6. 點擊紅色 "Delete Selected" 按鈕
7. 確認對話框出現，顯示工作數量
8. 點擊 "Confirm"
9. 觀察載入轉圈動畫
10. 確認工作被刪除，列表更新

**預期結果：**
- ✅ 核取方塊可以正常選擇
- ✅ 選中的工作有藍色光環高亮
- ✅ 顯示選中數量
- ✅ 確認對話框顯示正確訊息
- ✅ 刪除後列表自動更新

---

### 測試案例 2: 全選當前頁面

**步驟：**
1. 在 `test-batch` 佇列檢查器中
2. 點擊 "Select All (Page)" 核取方塊
3. 觀察所有可見工作被選中
4. 再次點擊取消全選
5. 使用鍵盤快捷鍵 **Ctrl+A** (Mac: Cmd+A)
6. 觀察所有工作再次被選中

**預期結果：**
- ✅ 全選核取方塊正常運作
- ✅ 鍵盤快捷鍵 Ctrl+A 正常運作
- ✅ 顯示 "50 of 100 total" (如果有分頁)

---

### 測試案例 3: 刪除所有匹配的工作

**步驟：**
1. 在 `test-batch` 佇列檢查器中
2. 觀察琥珀色警告橫幅顯示 "Showing 50 of 100 total waiting jobs"
3. 點擊紅色 "Delete All 100" 按鈕
4. 觀察強烈警告對話框，包含 ⚠️ 符號
5. 閱讀警告訊息
6. 點擊 "Confirm"
7. 觀察載入狀態
8. 確認所有 100 個工作被刪除

**預期結果：**
- ✅ 警告橫幅正確顯示總數
- ✅ 確認對話框顯示警告訊息
- ✅ 所有工作被刪除
- ✅ 佇列統計更新為 0

---

### 測試案例 4: 批次重試延遲工作

**步驟：**
1. 在 `test-batch-delayed` 佇列檢查器中
2. 切換到 "Delayed" 標籤
3. 觀察 30 個延遲工作
4. 選擇 10 個工作
5. 點擊藍色 "Retry Selected" 按鈕
6. 確認對話框出現
7. 點擊 "Confirm"
8. 切換回 "Waiting" 標籤
9. 確認 10 個工作已移至 waiting 佇列

**預期結果：**
- ✅ 延遲工作顯示排程時間
- ✅ 批次重試正常運作
- ✅ 工作從 delayed 移至 waiting

---

### 測試案例 5: 重試所有失敗的工作

**步驟：**
1. 在 `test-batch-fail` 佇列檢查器中
2. 切換到 "Failed" 標籤
3. 觀察 25 個失敗的工作
4. 觀察警告橫幅顯示 "Showing X of 25 total failed jobs"
5. 點擊琥珀色 "Retry All 25" 按鈕
6. 確認對話框出現
7. 點擊 "Confirm"
8. 切換回 "Waiting" 標籤
9. 確認所有失敗工作已移至 waiting 佇列

**預期結果：**
- ✅ 失敗工作顯示錯誤訊息
- ✅ "Retry All" 按鈕正常運作
- ✅ 所有失敗工作被重試
- ✅ Failed 計數歸零

---

### 測試案例 6: 鍵盤快捷鍵

**步驟：**
1. 在任何佇列檢查器中
2. 按 **Ctrl+A** (Mac: Cmd+A)
3. 觀察所有工作被選中
4. 按 **Escape**
5. 觀察選擇被清除
6. 再次按 **Escape**
7. 觀察檢查器關閉

**預期結果：**
- ✅ Ctrl+A 選擇所有可見工作
- ✅ 第一次 Escape 清除選擇
- ✅ 第二次 Escape 關閉檢查器
- ✅ 在確認對話框中，Escape 關閉對話框

---

### 測試案例 7: 確認對話框取消

**步驟：**
1. 選擇一些工作
2. 點擊 "Delete Selected"
3. 在確認對話框中點擊 "Cancel"
4. 確認工作沒有被刪除
5. 選擇仍然保持

**預期結果：**
- ✅ 取消按鈕正常運作
- ✅ 工作沒有被刪除
- ✅ 選擇狀態保持不變

---

### 測試案例 8: 封存工作（不可批次操作）

**步驟：**
1. 在任何佇列檢查器中
2. 切換到 "Archive" 標籤
3. 觀察封存的工作沒有核取方塊
4. 確認沒有批次操作按鈕

**預期結果：**
- ✅ 封存工作不顯示核取方塊
- ✅ 封存工作標記為 "Archive: completed/failed"
- ✅ 沒有批次操作選項

---

## 🧹 清理測試資料

測試完成後：

```bash
bun scripts/test-batch-operations.ts cleanup
```

---

## 📊 測試檢查清單

- [ ] 測試案例 1: 多選與批次刪除
- [ ] 測試案例 2: 全選當前頁面
- [ ] 測試案例 3: 刪除所有匹配的工作
- [ ] 測試案例 4: 批次重試延遲工作
- [ ] 測試案例 5: 重試所有失敗的工作
- [ ] 測試案例 6: 鍵盤快捷鍵
- [ ] 測試案例 7: 確認對話框取消
- [ ] 測試案例 8: 封存工作（不可批次操作）

---

## 🐛 已知問題

無

---

## 💡 提示

1. **效能測試**: 可以創建更多工作（1000+）來測試大量資料的效能
2. **瀏覽器相容性**: 建議在 Chrome、Firefox、Safari 上測試
3. **網路延遲**: 可以使用瀏覽器開發工具模擬慢速網路
4. **並發操作**: 嘗試同時開啟多個佇列檢查器

---

## 📝 回報問題

如果發現任何問題，請記錄：
1. 瀏覽器版本
2. 重現步驟
3. 預期行為
4. 實際行為
5. 控制台錯誤訊息（如果有）
